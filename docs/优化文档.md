# 项目优化参考

## .npmrc

查看项目中 .npmrc 文件

## token多环境隔离

```js
// 1. 避免 Domain 陷阱: 如果你尝试通过设置 domain 来解决，比如在 Dev 环境强行设置 domain 为 dev.admin.banxueketang.com，这可以防止 Dev 的 Token 跑到 Prod。但是，很难防止 Prod 的 Token (admin.banxueketang.com) 跑进 Dev（因为它是父级）。

// 2. 物理隔离
function getTokenKey() {
  return `Admin-Token-${extractEnvPrefix()}`
}

export function getToken() {
  return Cookies.get(getTokenKey())
}

export function setToken(token) {
  return Cookies.set(getTokenKey(), token)
}

// 获取url中的环境前缀
function extractEnvPrefix() {
  const hostname = window.location.hostname;
  const regex = /^(?:([a-zA-Z0-9-]+)\.)?admin\.banxueketang\.com$/;
  const match = hostname.match(regex);
  if (hostname === 'localhost') {
    return 'local';
  }
  if (match) {
    // match[1] 是环境前缀，如果为 undefined 则表示无前缀（生产环境）
    return match[1] || 'prod';
  }
  return 'unknown';
}
```

## 可扩展的自定义指令

1. 防抖

```js
 // 延迟执行
 <el-button
   type="success"
   :icon="Plus"
   v-debounce:1000="() => {}"
   circle
 />

 // 立即执行
 <el-button
   type="warning"
   :icon="Plus"
   v-debounce:1000.immediate="() => {}"
   circle
 />
```
